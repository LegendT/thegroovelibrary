{#
  Accessible Mixcloud Player Component

  Renders an individual Mixcloud cloudcast with proper accessibility attributes
  and WCAG 2.2 compliance.

  Parameters:
  - mix: Mixcloud cloudcast object from API

  Usage:
  {% include "mix-player.njk", mix: cloudcast %}
#}

<article class="mix-player" aria-labelledby="mix-{{ mix.slug }}">
  {# Cover Image with Player - Click to load for performance #}
  <div class="mix-player__media-wrapper"
       data-src="{{ helpers.getMixcloudEmbedUrl(mix.key) }}"
       data-title="Mixcloud player for {{ mix.name }}"
       data-aria-label="Audio player for {{ mix.name }}">
    {% if mix.pictures and mix.pictures.large %}
      <div class="mix-player__cover">
        <img
          src="{{ mix.pictures.large }}"
          alt="Cover art for {{ mix.name }}"
          class="mix-player__cover-image"
          loading="lazy"
          width="640"
          height="640"
          onerror="this.style.display='none'; this.parentElement.classList.add('mix-player__cover--fallback');">
        <button class="mix-player__play-overlay"
                aria-label="Click to load and play {{ mix.name }}">
          <span class="play-icon" aria-hidden="true">▶</span>
          <span class="play-text">Click to Play</span>
        </button>
      </div>
    {% else %}
      {# No image available - show fallback #}
      <div class="mix-player__cover mix-player__cover--fallback">
        <button class="mix-player__play-overlay"
                aria-label="Click to load and play {{ mix.name }}">
          <span class="play-icon" aria-hidden="true">▶</span>
          <span class="play-text">Click to Play</span>
        </button>
      </div>
    {% endif %}
  </div>

  <div class="mix-player__body">
    {# Top content container #}
    <div class="mix-player__content">
      {# Mix Title #}
      <h3 id="mix-{{ mix.slug }}" class="mix-player__title">
        <a href="{{ mix.url }}"
           target="_blank"
           rel="noopener noreferrer"
           aria-label="{{ mix.name }} - Open on Mixcloud in new window">
          {{ mix.name }}
          <i class="fa-solid fa-arrow-up-right-from-square fa-sm" aria-hidden="true"></i>
        </a>
      </h3>

      {# Mix Metadata #}
      <div class="mix-player__meta">
        {% if mix.created_time %}
          <div class="mix-player__meta-item">
            <i class="fa-solid fa-calendar fa-sm" aria-hidden="true"></i>
            <time datetime="{{ mix.created_time }}" aria-label="Published date">
              {{ helpers.formatDate(mix.created_time) }}
            </time>
          </div>
        {% endif %}

        {% if mix.audio_length %}
          <div class="mix-player__meta-item">
            <i class="fa-solid fa-clock fa-sm" aria-hidden="true"></i>
            <span aria-label="Duration">
              {{ helpers.formatDuration(mix.audio_length) }}
            </span>
          </div>
        {% endif %}

        {% if mix.play_count %}
          <div class="mix-player__meta-item">
            <i class="fa-solid fa-headphones fa-sm" aria-hidden="true"></i>
            <span aria-label="Play count">
              {{ mix.play_count | toLocaleString }} plays
            </span>
          </div>
        {% endif %}
      </div>

      {# Tags #}
      {% if mix.tags and mix.tags.length > 0 %}
        <div class="mix-player__tags" role="list" aria-label="Tags">
          {% for tag in mix.tags | slice(0, 5) %}
            <span class="mix-player__tag" role="listitem">
              {{ tag.name }}
            </span>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    {# Tracklist Container - pushed to bottom #}
    <div class="mix-player__bottom">
      {# Tracklist #}
      {% if mix.sections and mix.sections.length > 0 %}
        <details class="mix-player__tracklist">
          <summary class="mix-player__tracklist-summary">
            <i class="fa-solid fa-list-music fa-sm" aria-hidden="true"></i>
            <span>Tracklist ({{ mix.sections.length }} tracks)</span>
          </summary>
          <ol class="mix-player__tracklist-items" aria-label="Track listing">
            {% for section in mix.sections %}
              {% if section.section_type == 'track' and section.track %}
                <li class="mix-player__tracklist-item">
                  <span class="mix-player__tracklist-position">{{ section.position }}</span>
                  <div class="mix-player__tracklist-info">
                    <span class="mix-player__tracklist-artist">{{ section.track.artist or 'Unknown Artist' }}</span>
                    <span class="mix-player__tracklist-separator">—</span>
                    <span class="mix-player__tracklist-track">{{ section.track.name or 'Unknown Track' }}</span>
                  </div>
                  {% if section.start_time %}
                    <time class="mix-player__tracklist-time" datetime="PT{{ section.start_time }}S">
                      {{ helpers.formatDuration(section.start_time) }}
                    </time>
                  {% endif %}
                </li>
              {% endif %}
            {% endfor %}
          </ol>
        </details>
      {% endif %}
    </div>
  </div>
</article>
